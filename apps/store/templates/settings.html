{% extends "core/base.html" %}
{% load static %}

{% block extra_head %}

<link rel="preload " href="{% static 'statics/js/c8444127b6-settingspage.js'%}" as="script">
<script src="https://code.jquery.com/jquery-3.6.0.min.js" 
integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
crossorigin="anonymous"></script>
        <link rel="stylesheet" href="{% static 'statics/css/3b7bc560f0-settingspage_css.css' %}">
        {% endblock extra_head %}
        {% block content %}
        <div id="app" data-country="214" class="">
            <div id="page" class="wrapper content-page">
                <article id="content" class="content-wrapper">
                    <div id="main-section" class="section-wrapper content-attention">
                        <section class="section-entry-header">
                            <h1 class="title-section">Profile Settings</h1>
                            <a href="{% url "user_profile" profile.user %}" target="_blank" class="cta-view-profile"><i class="far fa-eye"></i>View profile</a>
                        </section>
                        <section class="section-entry-content">
                            <aside class="sidebar-content">
                                <div class="sidebar-navlink">
                                    <button class="navlink-select">My details</button>
                                    <ul class="navlink-profile">
                                        <li class="link-item ">
                                            <a href="#page-accountsetting"><i class="far fa-cog" aria-hidden="true"></i>Edit Your Profile Settings</a>
                                        </li>
                                        <li class="link-item link-selected">
                                            <a href="#page-accountdetail"><i class="far fa-address-card" aria-hidden="true"></i>My details</a>
                                        </li>
                                    </ul>
                                </div>
                            </aside>
                            <div class="main-content content-accountdetail main-content--active" id="page-accountdetail">
                                <h2 class="title-entry-content">My details</h2>
                                <div class="profile-field">
                                    <div class="gravatar-profile">

                                        <div class="preview-gravatar">
                                            {% if profile.image %}
                                            <img src="{{profile.image.url}}" alt="Gravatar Profil">
                                            {% else %}
                                            <img src=" {% static 'statics/img/user_icon.png' %} " alt="Gravatar Profil">
                                            {% endif %}
                                        </div>
                                        <form action="{% url "settings_profile" %}" class="upload-gravatar" id="upload-gravatar" method="post" enctype="multipart/form-data">
                                            {% csrf_token %}
                                            <input type="file" accept="image/png, image/jpeg, image/jpg, image/jpeg, image/gif" name="image" id="image">
                                            <button class="btn-upload-gravatar">Select file</button>
                                            <span class="desc-uploadfile">No file selected</span>
                                        </form>
                                    </div>
                                    <div class="desc-gravatar-profile">
                                        <div id="input_image-error" class="error-message image-error">The file is too large, the maximum size is: 2MB</div>
                                        <div id="submit-avatar-btn" class="submit-avatar-btn">Save</div>
                                        <p>The picture will be converted to 60x60 pixels. Supported extensions: GIF, JPG, JPEG and PNG. The maximum size is 2MB</p>
                                    </div>
                                </div>
                                <!-- Include this script at the bottom of your HTML body -->
                                    <script>
                                        document.addEventListener("DOMContentLoaded", function() {
                                            var submitButton = document.getElementById("about_btn");
                                            submitButton.addEventListener("click", function(event) {
                                                event.preventDefault();
                                                document.getElementById("form-about-me").submit();
                                            });
                                        });
                                        document.addEventListener("DOMContentLoaded", function() {
                                            var submitButton = document.getElementById("save-about-me");
                                            submitButton.addEventListener("click", function(event) {
                                                event.preventDefault();
                                                document.getElementById("form-about-me").submit();
                                            });
                                        });
                                    </script>

                                <form action="{% url "settings_edit" %}" id="form-about-me" method="post">
                                    {% csrf_token %}
                                    <div class="list-collect-data list-collect-personaldata">
                                        <div class="entry-header-collect">
                                            <h3 class="title-list-collect">About You</h3>
                                            <div class="cta-action-data" data-form="form-personal-data">
                                                <button class="cta-action-active" data-action="modify">Change</button>
                                                <button type="submit" id='about_btn' class="save-about-me" data-type="aboutme">Save</button>
                                            </div>
                                        </div>
                                        <div id="form-personal-data" class="form-data form-personal-data">
                                            <div class="input-field">
                                                <label for="firstname">First Name</label>
                                                <input type="text" name="firstname" id="firstname" value="{{profile.firstname}}" placeholder="" readonly="">
                                            </div>
                                            <div class="input-field">
                                                <label for="lastname">Last Name</label>
                                                <input type="text" name="lastname" id="lastname" value="{{profile.lastname}}" placeholder="" readonly="">
                                            </div>
                                            <div class="input-field">
                                                <label for="dob">Date of Birth ({{profile.dob}})</label>
                                                <input type="date" name="dob" id="dob" value="{{profile.dob}}" readonly="">
                                            </div>
                                        </div>
                                        <div id="input_aboutme-error" class="error-message"></div>
                                    </div>
                                    <div class="list-collect-data list-collect-studydata">

                                    </div>
                                    <div class="list-collect-data list-collect-salesprofile">
                                        <div class="entry-header-collect">
                                            <h3 class="title-list-collect">Education & Details</h3>
                                            <div class="cta-action-data" data-form="form-sales-profile">
                                                <button class="cta-action-active" data-action="modify">Change</button>
                                                <button id='save-about-me' class="save-about-me" data-type="sellerinfo">Save</button>
                                            </div>
                                        </div>
                                        <div id="form-sales-profile" class="form-data form-sales-profile">
                                            <div class="input-field">
                                                <label for="country">Country of study</label>
                                                <input type="text" name="country" id="country" value="{{profile.country}}" readonly="">
                                            </div>
                                            <div class="input-field">
                                                <label for="institution">Institution</label>
                                                <input type="text" name="institution" id="institution" value="{{profile.institution}}" readonly="" placeholder="">
                                            </div>
                                            <div class="input-field">
                                                <label for="education">Education</label>
                                                <input type="text" name="education" id="education" value="{{profile.education}}" readonly="" placeholder="">
                                            </div>
                                            <div class="input-field">
                                                <label for="academicyear">Academic year</label>
                                                <input type="text" name="academicyear" id="academicyear" value="{{profile.academicyear}}" readonly="">
                                            </div>
                                            <div class="entry-header-collect" style="margin-top:35px;">
                                                <h3 class="title-list-collect">Seller profile page</h3>
                                            </div>
                                            <div class="input-field">
                                                <label for="input_title-store">Title of your shop</label>
                                                <input type="text" name="shoptitle" id="shoptitle" value="{{profile.shoptitle}}" readonly="">
                                            </div>
                                            <div class="input-field">
                                                <label for="input_describe-store">Description of your store</label>
                                                <textarea name="shopdescription" id="shopdescription" readonly="">{{profile.shopdescription|safe}}</textarea>
                                            </div>
                                            
                                        </div>
                                        <div id="input_sellerinfo-error" class="error-message"></div>
                                    </div>
                                </form>
                            </div>
                            <div class="main-content content-accountsetting " id="page-accountsetting">
                                <h2 class="title-entry-content">Edit Your Profile Settings</h2>
                                <div class="list-profile-data">
                                    <div class="cta-action-data" data-form="form-language-data">
                                        {% comment %} <button class="cta-action-active changeCountry">Change</button> {% endcomment %}
                                    </div>
                                    <div id="form-language-data" class="form-data form-language-data">
                                        <div class="input-field">
                                            <label for="input_language">Language</label>
                                            <input type="text" name="input_language" id="input_language" value="English" readonly="">
                                        </div>
                                    </div>
                                </div>
                                <div class="list-profile-data">
                                    <div id="work-button" class="cta-action-data cta-action--active" data-form="form-username-data">
                                        <button id="change-username" class="cta-action-active" data-action="modify">Change</button>
                                        <button id="save-username">Save</button>
                                    </div>
                                    <div id="form-username-data" class="form-data form-username-data">
                                        <div class="input-field">
                                            <label for="input_username">Username</label>
                                            <input type="text" name="input_username" id="input_username" value="{{user.username}}" placeholder="Letters and numbers only" readonly="">
                                            <div id="input_username-error" class="error-message">Unable to Change</div>
                                            {% csrf_token %}
                                            <input type="hidden" id="user_id" value="{{user.id}}">
                                        </div>
                                    </div>
                                </div>
                                {% comment %} <script>
                                    $(document).on("click", "#save-username", function() {
                                        console.log("clciking...");
                                        var newUsername = $("#input_username").val(); 
                                        var userId = $("#user_id").val(); 
                                        var apiUrl = '/api/users/' + userId + '/update-username/';
                                        var requestData = {
                                            // "csrf": $("input[name='csrfmiddlewaretoken']").val(), 
                                            "username": newUsername 
                                        };
                                        $.ajax({
                                            url: apiUrl, 
                                            type: 'PUT', 
                                            headers: {'X-CSRF-TOKEN': $("input[name='csrfmiddlewaretoken']").val()},
                                            contentType: 'application/json', 
                                            data: JSON.stringify(requestData), 
                                            success: function(response) {
                                                console.log('Username updated successfully:', response);
                                            },
                                            error: function(xhr, status, error) {
                                                console.error('Error updating username:', error);
                                            }
                                        });
                                    })
                                </script> {% endcomment %}

                                <div class="list-profile-data">
                                    <div id="form-delete-user" class="form-data form-delete-user">
                                        <div class="input-field">
                                            <label>Delete Profile</label>
                                            <button class="cta-delete-user">I would like to delete my profile</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </article>
            </div>
            <div id="delete-profile-wrapper" class="delete-profile-wrapper">
                <div class="warning-icon"></div>
                <div class="section-entry-header">
                    <h1><i class="fa fa-exclamation-triangle"></i> Are your sure you want to delete your profile?</h1>
                </div>
                <div class="alert-box alert-danger">
                    Deleting your profile cannot be undone. This also means that all your uploaded documents and saved downloads will be removed. Any outstanding payments will be settled (if your bank details are complete).
                </div>
                <span id="delete-profile-btn">Delete profile</span>
            </div>
        </div>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                var button = document.getElementById("delete-profile-btn");
                button.addEventListener("click", function() {
                    window.location.href = "{% url 'delete_profile' %}";
                });
            });
            document.addEventListener("DOMContentLoaded", function() {
                var button = document.getElementById("smallsearchbox");
                button.addEventListener("click", function() {
                    // Toggle the 'active' class on the button
                    button.classList.toggle("active");
                });
            });
            document.addEventListener("DOMContentLoaded", function() {
                var button = document.getElementById("navmanubtn");
                button.addEventListener("click", function() {
                    // Toggle the 'active' class on the button
                    var butt = document.getElementById("sidnavbar");
                    butt.classList.toggle("active");
                });
            });
            document.addEventListener("DOMContentLoaded", function() {
                var button = document.getElementById("mobile-header-close-action");
                button.addEventListener("click", function() {
                    // Toggle the 'active' class on the button
                    var butt = document.getElementById("sidnavbar");
                    butt.classList.toggle("active");
                });
            });
            document.addEventListener("DOMContentLoaded", function() {
                var button = document.getElementById("header-cart");
                try{
                button.addEventListener("click", function() {
                    // Toggle the 'active' class on the button
                    button.classList.toggle("active");
                });}
                catch{

                }
            });
            </script>
        <script defer="" type="text/javascript" src="{% static 'statics/js/c38bfd2f53-app.js'%}"></script>
        <script defer="" type="text/javascript" src="{% static 'statics/js/c8444127b6-settingspage.js'%}"></script>
        {% endblock content %}